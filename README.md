# Catalyst

A rest API generator for node/postgres

## What it does

When provided with a Postgres database, Catalyst does the following:

- Creates an OpenAPI specification and saves it to openapi.3.0.0.json in the root folder

- Creates a REST API that consumes the OpenAPI spec and puts the autogenerated code in the `/api` folder

- Creates interactive Swagger docs at /api/v1/api-docs

## Setting up
### Generating certificates

This step generates two files, `localhost.pem` and `localhost-key.pem` in the folder `certs`.
This makes the local web app work over HTTPS

Create a folder called `certs` in the main directory and move to it:

`$ mkdir certs`

`$ cd certs`

Install the `mkcert` package:

`$ brew install mkcert`

`$ mkcert -install`

Generate the key files:

`$ mkcert localhost`

## How to run

Use: 

`npm run dev`

### Generating the API 

*When running for the first time:*

In a browser, go to [https://localhost:9000/api/generator/build](https://localhost:9000/api/generator/build)

The generator connects to a postgres database using the credentials in `.env` file.
It then creates a file `openapi.3.0.0.json` and writes code to the `/api` folder to perform SQL queries.
Express routes are automatically mapped to the `/api` folder code in `index.js`.


### Using the API 

Re-start the app.

In a browser, go to  [https://localhost:9000/api/v1/api-docs](https://localhost:9000/api/v1/api-docs) to see interactive API docs.

You must provide an Authorization Bearer header (any value) to perform calls.



## Opinions

- tables are assumed to have an `id` field of type serial (primary key), 
and optionally a `uuid` field, which should be `NOT NULL`.

- table names ending in `_status` are assumed to have an `id` field and a description column
which are iterated in an autogenerated file at `api/enums/index.js` so they can be used in code to refer to status values.

- PUT (update) API calls are not available for tables without a `uuid` field (eg. status tables).



